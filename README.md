## Телеграмм бот для анкетирования

### Общее

При создании бота рекомендуется запретить его добавление в группы и не включать инлайн для глобальной видимости.

### Параметры для запуска

|Параметр| Значение                                          | Пример                  |
|-------|---------------------------------------------------|-------------------------|
|urls | Урлы, по которому доступен API                    | "http://localhost:9002" |
|dbPath | Путь, к папке, где хранятся данные бота           | tmp                     |
|botToken | Токен, выдаваемый BotFather                       |                         |
|pathToQuest| Путь к файлу с шаблоном анкеты                    | sample.csv              |
|adminID| Id пользователя ТГ, который станет первым админом | 12345                   |

Пример запуска под windows:

```
RQ.Bot.exe --urls="http://localhost:9002" --dbPath=tmp --botToken=xxxxxxx:yyyyyyyyyyyyy --pathToQuest=sample.csv
```

### API 

Все запросы к API требуют заголовка `X-Volunteer-Token`, с токеном, который выдается только админам самим ботом.

### Администраторы

Первый пользователь, обратившийся к боту автоматически становятся администратором, все последующие могут получить этот статус только од другого администратора.

### Шаблон анкеты

Файл с шаблоном анкеты должен быть представлен в формате csv c заголовками `Text` и `ValidationRegex`.
В поле `Text` вписывается вопрос, а в `ValidationRegex` регулярное выражение для проверки правильности ввода.
С помощью регулярок можно контролировать ввод чисел, дат, номеров телефонов, категорий и т.д. 
Если ввод может быть произвольным, то `ValidationRegex` можно оставить пустым.

`Category` определяет пункт меню, в котором находится указанный вопрос. Символ `->` разделяет пункты в иерархии.
В примере ниже создается меню следущего вида

|           |
|-----------| 
|Главное    |
|Потребности|

В секции `Главное` еще одно подменю

| Главное    |
|------------| 
| Персональное    |
| Местоположение |

*ВАЖНО* Текс вопроса является его же уникальным идентификатором. 
Если вы отредактируете в уже существующей анкете текст вопроса, то в выгрузке могут быть дубли из старых вопросов.

Пример шаблона с меню категорий:

```csv
Text,Group,IsGroupSwitch,DuplicateCheck,Category,ValidationRegex
"Обязательный вопрос 1",0,0,0,,
"Обязательный вопрос 2",0,0,0,,
"Обязательный вопрос 3",0,0,0,,
"Обязательный вопрос 4",0,0,0,,
"Ваше ФИО:",0,0,0,"Главное->Персональное"
"Какого вы года рождения?",0,0,1,"Главное->Персональное","\d{4}"
"Где вы находитесь?",0,0,0,"Главное->Местоположение"
"Нужна одежда?",1,1,0,"Потребности"
"Размер одежды",1,0,0,"Потребности"
"Тип одежды",1,0,0,"Потребности"
"Нужен мотоцикл?",2,1,0,"Потребности"
"Размер мотоцикла",2,0,0,"Потребности"
"Марка",2,0,0,"Потребности"
"Нужно жилье?",3,1,0,"Потребности"
"Сколько человек",3,0,0,"Потребности"
"Регион",3,0,0,"Потребности"
```

Пример шаблона без меню, с обязательными и необязательными вопросами:
```csv
Text,Group,IsGroupSwitch,DuplicateCheck,Category,ValidationRegex
"Обязательный вопрос 1",0,0,0,,
"Обязательный вопрос 2",0,0,0,,
"Обязательный вопрос 3",0,0,0,,
"Обязательный вопрос 4",0,0,0,,
"Ваше ФИО:",0,0,0,
"Какого вы года рождения?",0,0,1,,"\d{4}"
"Где вы находитесь?",0,0,0,
"Нужна одежда?",1,1,0,
"Размер одежды",1,0,0,
"Тип одежды",1,0,0,
"Нужен мотоцикл?",2,1,0,
"Размер мотоцикла",2,0,0,
"Марка",2,0,0,
"Нужно жилье?",3,1,0,
"Сколько человек",3,0,0,
"Регион",3,0,0,
```